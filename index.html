<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>North Slope Shift Calendar</title>

  <!-- Icons / Manifest (optional but recommended) -->
  <link rel="apple-touch-icon" href="icon.png">
  <link rel="icon" type="image/png" sizes="192x192" href="icon.png">
  <link rel="manifest" href="manifest.json">

  <style>
  :root{
    --on-color:#3498db;
    --travel-color:#e67e22;
    --off-color:#ffffff;

    --text-main:#333;
    --bg-body:#f0f2f5;
    --bg-card:#ffffff;

    --border-color:#eee;
    --border-strong:#000;

    /* Base tint variables; JS updates these from the slider */
    --on-tint-soft: rgba(52,152,219,0.12);
    --travel-tint-soft: rgba(230,126,34,0.14);
    --on-tint-strong: rgba(52,152,219,0.16);
    --travel-tint-strong: rgba(230,126,34,0.18);

    /* Added for Standard & Aurora themes */
    --on-solid-rgba: rgba(52,152,219,0.75);
    --travel-solid-rgba: rgba(230,126,34,0.75);
    --on-aurora-rgba: rgba(52,152,219,0.85);
    --travel-aurora-rgba: rgba(230,126,34,0.85);
  }
  body.dark-mode{
    --off-color:#2c3e50;
    --text-main:#ecf0f1;
    --bg-body:#1a1a1a;
    --bg-card:#2d2d2d;
    --border-color:#444;
    --border-strong:#e6e6e6;
  }
  body{
    font-family:'Segoe UI',system-ui,sans-serif; padding:20px;
    background:var(--bg-body); color:var(--text-main); margin:0;
    transition:background .3s,color .3s;
  }

  .header-container{
    display:grid; grid-template-columns:1fr auto 1fr; align-items:center;
    gap:16px; margin-bottom:10px;
  }
  #pageTitle{ justify-self:start; margin:0; font-size:1.5rem; font-weight:800; }
  .legend{
    justify-self:end; display:flex; gap:15px; background:var(--bg-card);
    padding:10px 15px; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,.1);
    font-size:1rem; font-weight:700;
  }
  .legend-item{ display:flex; align-items:center; gap:6px; }
  .dot{ width:12px; height:12px; border-radius:50%; border:2px solid var(--border-strong); }
  #nameInlineWrap{ justify-self:center; }
  .name-chip{
    display:inline-flex; align-items:center; gap:10px; padding:8px 12px;
    border-radius:10px;
    background:linear-gradient(135deg,var(--on-color),var(--travel-color));
    color:#fff; font-weight:800; letter-spacing:.2px;
    box-shadow:0 4px 14px rgba(0,0,0,.12); font-size:1.05rem;
  }
  .name-chip .label{ opacity:.9; font-weight:700; font-size:.95rem; }
  .name-chip .value{ font-size:1.1rem; }
  #nameInline{ display:none; }

  /* Controls */
  .controls{
    background:var(--bg-card); padding:14px; border-radius:12px; gap:10px; row-gap:10px;
    box-shadow:0 4px 12px rgba(0,0,0,.1); align-items:end; display:grid;
    grid-template-columns: repeat(auto-fit, minmax(180px,1fr));
  }
  .control-group{ display:flex; flex-direction:column; gap:2px; }
  label{ font-weight:700; font-size:.85em; color:var(--text-main); opacity:.9; }
  input,select{
    padding:6px 8px; border:1px solid var(--border-color); border-radius:5px;
    width:170px; max-width:42vw; background:var(--bg-card); color:var(--text-main);
    font-size:.95rem;
  }
  input[type=range]{ width:180px; }
  .btn{ padding:8px 12px; border-radius:6px; cursor:pointer; font-weight:800; border:none; transition:.2s; font-size:.95rem; }
  .btn-gen{ background:#2ecc71; color:#fff; }
  .btn-dark{ background:#34495e; color:#fff; }

  /* Calendar layouts */
  .calendar-grid{ display:grid; gap:22px; --month-min:340px; }
  .layout-standard{ --month-min:360px; grid-template-columns:repeat(auto-fit,minmax(var(--month-min),1fr)); gap:22px; }
  .layout-compact { --month-min:340px; grid-template-columns:repeat(auto-fit,minmax(var(--month-min),1fr)); gap:16px; }
  .layout-poster  { --month-min:380px; grid-template-columns:repeat(auto-fit,minmax(var(--month-min),1fr)); gap:26px; }
  .layout-grid    { --month-min:360px; grid-template-columns:repeat(auto-fit,minmax(var(--month-min),1fr)); gap:20px; }
  .layout-wall    { --month-min:360px; grid-template-columns:repeat(auto-fit,minmax(var(--month-min),1fr)); gap:20px; }

  #calendar-scale-wrapper{
    --calendar-design-width:1600px;
    width:100%; display:flex; justify-content:center; overflow:visible; margin-top:6px;
  }
  #calendar-scale-wrapper > #calendar{ max-width:var(--calendar-design-width); }

  .month{
    background:var(--bg-card); border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,.1);
    padding:18px; border:2px solid var(--border-strong);
  }
  h3{ text-align:center; color:var(--on-color); border-bottom:2px solid var(--border-strong); padding-bottom:10px; margin-top:0; font-size:1.25rem; font-weight:800; }
  .weekday-header,.days{ display:grid; grid-template-columns:repeat(7,1fr); text-align:center; }
  .weekday-header{ font-weight:800; color:#666; font-size:.95em; margin-bottom:10px; }
  .day{
    aspect-ratio:1; display:flex; align-items:center; justify-content:center; border-radius:8px;
    font-size:1.05em; border:2px solid var(--border-strong); font-weight:700;
  }
  .on-shift{ color:#fff; }
  .travel-day{ color:#fff; }
  .off-day{ background:var(--off-color); color:var(--text-main); }
  .today{ outline:3px solid #e74c3c; outline-offset:-3px; }
  .empty{ visibility:hidden; }
  input[type=color]{ padding:0; height:38px; cursor:pointer; }

  /* THEMES */

  /* --- Standard (Classic Cards) --- */
  .theme-standard .month { border:2px solid var(--border-strong); box-shadow:0 3px 10px rgba(0,0,0,.08); }
  .theme-standard h3 { color: var(--on-color); }
  .theme-standard .weekday-header { color:#5b6b7c; }
  .theme-standard .day { border-radius:999px; background:#f6f9ff; }
  .theme-standard .off-day { background:#f2f6fb; color:#222; }
  /* Tint-controlled fills (uses --on-solid-rgba / --travel-solid-rgba) */
  .theme-standard .on-shift {
    background: linear-gradient(135deg, var(--on-solid-rgba), var(--on-color)) !important;
    color:#fff; border-color:var(--on-color);
  }
  .theme-standard .travel-day {
    background: linear-gradient(135deg, var(--travel-solid-rgba), var(--travel-color)) !important;
    color:#fff; border-color:var(--travel-color);
  }

  /* --- Aurora --- */
  .theme-aurora .month{
    border:2px solid var(--border-strong); border-radius:16px;
    background: radial-gradient(1200px 600px at -10% -20%, rgba(52,152,219,.12), transparent 60%),
                radial-gradient(1000px 500px at 120% 10%, rgba(230,126,34,.12), transparent 55%),
                #ffffff;
    box-shadow:0 14px 32px rgba(0,0,0,.12); overflow:hidden;
  }
  .theme-aurora h3{
    color:#fff; text-transform:uppercase; letter-spacing:.12em; font-weight:900;
    margin:-18px -18px 14px -18px; padding:16px 14px;
    background:linear-gradient(135deg, var(--on-color), var(--travel-color));
    border:none; font-size:1.25rem; text-shadow:0 1px 0 rgba(0,0,0,.25);
  }
  .theme-aurora .weekday-header{
    background: linear-gradient(90deg, rgba(0,0,0,.03), rgba(0,0,0,0));
    color:#2c3e50; font-weight:900; letter-spacing:.04em;
    border:1px solid rgba(0,0,0,.12); border-left:none; border-right:none;
  }
  .theme-aurora .day{ border-radius:10px; background:#f9fbff; position:relative; overflow:hidden; }
  .theme-aurora .day::after{
    content:""; position:absolute; inset:0; pointer-events:none;
    background-image: repeating-linear-gradient(45deg, rgba(255,255,255,.4) 0 6px, rgba(255,255,255,0) 6px 12px);
    mix-blend-mode: overlay;
  }
  .theme-aurora .off-day{ background:#f3f6fb; color:#213042; }
  /* Tint-controlled aurora gradient first stop (uses --on-aurora-rgba / --travel-aurora-rgba) */
  .theme-aurora .on-shift{
    background: linear-gradient(135deg, var(--on-aurora-rgba), var(--on-color));
    color:#fff; border-color: var(--on-color); text-shadow:0 1px 0 rgba(0,0,0,.25);
  }
  .theme-aurora .travel-day{
    background: linear-gradient(135deg, var(--travel-aurora-rgba), var(--travel-color));
    color:#fff; border-color: var(--travel-color); text-shadow:0 1px 0 rgba(0,0,0,.25);
  }

  /* --- Clean Grid --- */
  .theme-clean-grid .month { border:2px solid #000; box-shadow:none; background:#fff; }
  .theme-clean-grid h3 { color:#111; background:#f1f3f5; border:none; padding:12px; border-radius:6px; }
  .theme-clean-grid .weekday-header { background:#f6f7f8; color:#333; border:1px solid #000; border-left:none; border-right:none; }
  .theme-clean-grid .day { border-radius:0; background:#fff; border-color:#000; }
  .theme-clean-grid .on-shift { background: var(--on-tint-soft) !important; color:#0b3e69; border-color:#000 !important; }
  .theme-clean-grid .travel-day { background: var(--travel-tint-soft) !important; color:#6a350a; border-color:#000 !important; }

  /* --- Wall --- */
  .theme-wall .month { border:2px solid #000; border-radius:10px; background:#fff; box-shadow:0 2px 6px rgba(0,0,0,.06); }
  .theme-wall h3 { text-transform:uppercase; letter-spacing:.05em; color:#fff; margin:-18px -18px 12px -18px; padding:14px 12px; background:var(--on-color); border:none; }
  .theme-wall .weekday-header { color:#222; font-weight:900; letter-spacing:.02em; }
  .theme-wall .day { border-radius:0; justify-content:flex-end; align-items:flex-start; padding:6px 8px; background:#fff; border-color:#000; }
  .theme-wall .off-day { background:#fff; color:#222; }
  .theme-wall .on-shift { background: var(--on-tint-strong) !important; color:#0b3e69; border-color:#000 !important; }
  .theme-wall .travel-day { background: var(--travel-tint-strong) !important; color:#6a350a; border-color:#000 !important; }

  /* --- Poster --- */
  .theme-poster .month { border:3px solid #111; border-radius:4px; background:#fff; box-shadow:none; }
  .theme-poster h3 { color:#111; text-transform:uppercase; letter-spacing:.08em; border:none; padding:6px 0 10px; }
  .theme-poster .day { border-radius:6px; }
  /* Tint-controlled fills (use the stronger tints for punch) */
  .theme-poster .on-shift { background: var(--on-tint-strong) !important; color:#111; border-color:#111 !important; }
  .theme-poster .travel-day { background: var(--travel-tint-strong) !important; color:#111; border-color:#111 !important; }

  /* ---- Letter image export (PNG): fill 8.5"x11" content area, readable ---- */
  .png-letter #pageTitle { font-size: 1.3rem !important; }
  .png-letter .legend { padding: 8px 10px !important; gap: 10px !important; font-size: 0.95rem !important; box-shadow: none !important; }
  .png-letter .calendar-grid { grid-template-columns: repeat(3, 1fr) !important; gap: 10px !important; --month-min: 0 !important; }
  .png-letter .month { padding: 12px !important; }
  .png-letter h3 { padding-bottom: 8px !important; font-size: 1.1rem !important; border-width: 1px !important; }
  .png-letter .weekday-header { margin-bottom: 8px !important; }

  /* Mobile toolbar + controls toggle */
  .mini-toolbar{
    position:sticky; top:6px; z-index:5; display:none; gap:8px; padding:6px; margin:6px 0 8px;
    background:rgba(255,255,255,.9); backdrop-filter: blur(4px); border:1px solid var(--border-color);
    border-radius:8px; box-shadow:0 2px 10px rgba(0,0,0,.08);
  }
  .mini-btn{ padding:8px 10px; font-weight:800; border:none; border-radius:6px; background:#e9ecef; color:#222; }
  .mini-btn:nth-child(1){ background:#2ecc71; color:#fff; }         /* Update */
  .mini-btn:nth-child(2){ background:#3498db; color:#fff; }         /* Image */
  .controls-toggle{ display:none; margin:8px 0 10px; padding:10px 12px; font-weight:800; border:1px solid var(--border-color); border-radius:8px; background:#fff; color:var(--text-main); box-shadow:0 2px 6px rgba(0,0,0,.06); }

  @media (max-width:700px){
    .mini-toolbar{ display:flex; }
    .controls-toggle{ display:inline-block; }
    .controls.is-collapsed{ display:none !important; }
    .controls{ margin-top:6px; padding:10px; gap:8px; row-gap:8px; grid-template-columns:1fr; }
    .controls label{ font-size:.8em; }
    .controls input, .controls select{ width:100%; max-width:100%; }
    .controls .btn{ width:100%; }
  }

  @media print{ @page{ size:auto; margin:0.25in; } }
  </style>

  <!-- html2canvas (used only when you click “Download Image”) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" defer></script>
</head>
<body>
  <div id="calendar-capture-root">
    <div class="header-container">
      <h2 id="pageTitle">North Slope Shift Calendar</h2>
      <div id="nameInlineWrap">
        <div id="nameInline" class="name-chip">
          <span class="label">Name:</span><span class="value" id="nameInlineText"></span>
        </div>
      </div>
      <div class="legend">
        <div class="legend-item"><div class="dot" style="background:var(--on-color);"></div> Work</div>
        <div class="legend-item"><div class="dot" style="background:var(--travel-color);"></div> Travel</div>
        <div class="legend-item"><div class="dot" style="background:var(--off-color);"></div> Off</div>
      </div>
    </div>

    <!-- Mobile quick actions -->
    <div class="mini-toolbar" role="toolbar" aria-label="Quick actions">
      <button type="button" class="mini-btn" onclick="generateCalendar()">Update</button>
      <button type="button" class="mini-btn" onclick="downloadCalendarImage()">Image</button>
    </div>

    <!-- Mobile controls toggle -->
    <button type="button" id="controlsToggle" class="controls-toggle" aria-expanded="false">Show Controls</button>

    <div class="controls">
      <div class="control-group"><label for="yearSelect">Year</label><input type="number" id="yearSelect" min="1970" max="2100" value="2026" oninput="handleYearChange()"></div>
      <div class="control-group"><label for="daysOn">Days ON</label><input type="number" id="daysOn" min="1" step="1" value="21"></div>
      <div class="control-group"><label for="daysOff">Days OFF</label><input type="number" id="daysOff" min="1" step="1" value="21"></div>
      <div class="control-group"><label for="startDate">1st Day ON</label><input type="date" id="startDate" value="2026-01-08"></div>
      <div class="control-group"><label for="layoutStyle">Style</label>
        <select id="layoutStyle" onchange="generateCalendar()">
          <option value="layout-wall theme-wall">Wall Calendar</option>
          <option value="layout-grid theme-clean-grid">Clean Grid</option>
          <option value="layout-poster theme-poster">Poster Board</option>
          <option value="layout-compact theme-aurora">Aurora Mosaic</option>
          <option value="layout-standard theme-standard">Classic Cards</option>
        </select>
      </div>
      <div class="control-group"><label for="workColor">Work</label><input type="color" id="workColor" value="#3498db" oninput="updateColors(); saveSettings()" aria-label="Work color"></div>
      <div class="control-group"><label for="travelColor">Travel</label><input type="color" id="travelColor" value="#e67e22" oninput="updateColors(); saveSettings()" aria-label="Travel color"></div>
      <div class="control-group"><label for="tintStrength">Tint strength</label>
        <input type="range" id="tintStrength" min="8" max="30" step="1" value="16" oninput="updateColors(); saveSettings();">
      </div>

      <div class="control-group"><label for="nameField">Name (optional)</label><input type="text" id="nameField" placeholder="e.g., Turd Ferguson" oninput="handleNameInput(); saveSettings()" maxlength="80"></div>

      <button type="button" class="btn btn-gen" onclick="generateCalendar()">Update</button>
      <button type="button" class="btn btn-dark" onclick="toggleDarkMode()">Dark Mode</button>

      <!-- Image button (Letter-sized high-res PNG) -->
      <button type="button" class="btn" style="background:#3498db;color:#fff;" onclick="downloadCalendarImage()">Download Image</button>

      <!-- Hidden input kept for backward compatibility (ignored by image export) -->
